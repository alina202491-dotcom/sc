name: Workflow Status Summary

on:
  workflow_run:
    workflows: 
      - "CI"
      - "Security Scan"
      - "Code Quality"
      - "Performance Testing"
      - "Documentation"
    types:
      - completed
  schedule:
    # Run status summary daily at 8 AM UTC
    - cron: '0 8 * * *'
  workflow_dispatch:

jobs:
  summary:
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch'
    steps:
    - uses: actions/checkout@v5

    - name: Generate Workflow Status Summary
      run: |
        cat > workflow-status.md << 'EOF'
        # ğŸ”„ GitHub Actions å·¥ä½œæµçŠ¶æ€æ‘˜è¦
        
        > ç”Ÿæˆæ—¶é—´: $(date)
        > ä»“åº“: ${{ github.repository }}
        > åˆ†æ”¯: ${{ github.ref_name }}
        
        ## ğŸ“Š å½“å‰çŠ¶æ€æ¦‚è§ˆ
        
        | å·¥ä½œæµ | çŠ¶æ€ | æœ€åè¿è¡Œ | æè¿° |
        |--------|------|----------|------|
        | CI | [![CI](https://github.com/${{ github.repository }}/actions/workflows/ci.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/ci.yml) | - | æŒç»­é›†æˆæµ‹è¯• |
        | Security Scan | [![Security](https://github.com/${{ github.repository }}/actions/workflows/security.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/security.yml) | - | å®‰å…¨æ‰«æ |
        | Code Quality | [![Code Quality](https://github.com/${{ github.repository }}/actions/workflows/code-quality.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/code-quality.yml) | - | ä»£ç è´¨é‡æ£€æŸ¥ |
        | Performance | [![Performance](https://github.com/${{ github.repository }}/actions/workflows/performance.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/performance.yml) | - | æ€§èƒ½æµ‹è¯• |
        | Documentation | [![Docs](https://github.com/${{ github.repository }}/actions/workflows/docs.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/docs.yml) | - | æ–‡æ¡£ç”Ÿæˆ |
        
        ## ğŸ”§ å·¥ä½œæµè¯¦æƒ…
        
        ### CI å·¥ä½œæµ
        - **è§¦å‘æ¡ä»¶**: Push åˆ° main/master/develop åˆ†æ”¯ï¼ŒPR
        - **æµ‹è¯•ç¯å¢ƒ**: Python 3.8-3.12
        - **æ£€æŸ¥é¡¹ç›®**:
          - âœ… è¯­æ³•æ£€æŸ¥ (flake8)
          - âœ… ä»£ç æ ¼å¼æ£€æŸ¥ (black)
          - âœ… å¯¼å…¥æ’åºæ£€æŸ¥ (isort)
          - âœ… ç±»å‹æ£€æŸ¥ (mypy)
          - âœ… è„šæœ¬éªŒè¯
        
        ### Security å·¥ä½œæµ  
        - **è§¦å‘æ¡ä»¶**: Push åˆ° main/masterï¼ŒPRï¼Œæ¯æ—¥å®šæ—¶
        - **å®‰å…¨æ£€æŸ¥**:
          - ğŸ”’ ä¾èµ–æ¼æ´æ‰«æ (Safety, pip-audit)
          - ğŸ”’ ä»£ç å®‰å…¨æ‰«æ (Bandit)
          - ğŸ”’ å¯†é’¥æ³„éœ²æ£€æµ‹ (TruffleHog)
          - ğŸ”’ ä»£ç è´¨é‡åˆ†æ (CodeQL)
        
        ### Code Quality å·¥ä½œæµ
        - **è§¦å‘æ¡ä»¶**: Pushï¼ŒPR
        - **è´¨é‡æ£€æŸ¥**:
          - ğŸ“Š ä»£ç å¤æ‚åº¦åˆ†æ (radon)
          - ğŸ“Š å¯ç»´æŠ¤æ€§æŒ‡æ•°
          - ğŸ“Š ä»£ç é£æ ¼æ£€æŸ¥ (pylint)
          - ğŸ¨ è‡ªåŠ¨æ ¼å¼åŒ– (PR æ—¶)
        
        ### Performance å·¥ä½œæµ
        - **è§¦å‘æ¡ä»¶**: Push åˆ° main/masterï¼ŒPRï¼Œæ¯å‘¨å®šæ—¶
        - **æ€§èƒ½æµ‹è¯•**:
          - âš¡ åˆå§‹åŒ–æ—¶é—´æµ‹è¯•
          - âš¡ å†…å­˜ä½¿ç”¨åˆ†æ
          - âš¡ å¹¶å‘æ€§èƒ½æµ‹è¯•
          - âš¡ ä¾èµ–åŠ è½½æ—¶é—´
        
        ### Documentation å·¥ä½œæµ
        - **è§¦å‘æ¡ä»¶**: æ–‡æ¡£æ–‡ä»¶å˜æ›´
        - **æ–‡æ¡£æ£€æŸ¥**:
          - ğŸ“– API æ–‡æ¡£ç”Ÿæˆ
          - ğŸ“– Markdown æ ¼å¼æ£€æŸ¥
          - ğŸ“– é“¾æ¥æœ‰æ•ˆæ€§éªŒè¯
        
        ## ğŸ·ï¸ å‘å¸ƒå·¥ä½œæµ
        
        ### Release å·¥ä½œæµ
        - **è§¦å‘æ¡ä»¶**: ç‰ˆæœ¬æ ‡ç­¾ (v*.*.*)ï¼Œæ‰‹åŠ¨è§¦å‘
        - **å‘å¸ƒæµç¨‹**:
          - ğŸ“¦ åˆ›å»ºå‘å¸ƒåŒ… (ZIP, TAR.GZ)
          - ğŸ“¦ æ„å»º Docker é•œåƒ
          - ğŸ“ è‡ªåŠ¨ç”Ÿæˆå˜æ›´æ—¥å¿—
          - ğŸš€ åˆ›å»º GitHub Release
        
        ## ğŸ¤– è‡ªåŠ¨åŒ–åŠŸèƒ½
        
        ### Dependabot
        - **æ›´æ–°é¢‘ç‡**: æ¯å‘¨ä¸€
        - **ç›‘æ§å†…å®¹**:
          - Python ä¾èµ–åŒ…
          - GitHub Actions ç‰ˆæœ¬
        
        ### è‡ªåŠ¨åŒ–ä»»åŠ¡
        - ğŸ”„ ä»£ç è‡ªåŠ¨æ ¼å¼åŒ– (PR)
        - ğŸ”„ å®‰å…¨æ‰«ææŠ¥å‘Šä¸Šä¼ 
        - ğŸ”„ æ€§èƒ½æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
        - ğŸ”„ æ–‡æ¡£è‡ªåŠ¨æ›´æ–°
        
        ## ğŸ“‹ é—®é¢˜æ¨¡æ¿
        
        é¡¹ç›®æä¾›äº†ä»¥ä¸‹ Issue æ¨¡æ¿ï¼š
        - ğŸ› Bug æŠ¥å‘Š
        - âœ¨ åŠŸèƒ½è¯·æ±‚  
        - ğŸ”’ å®‰å…¨æŠ¥å‘Š
        
        ## ğŸ”— å¿«é€Ÿé“¾æ¥
        
        - [Actions é¡µé¢](https://github.com/${{ github.repository }}/actions)
        - [Security é¡µé¢](https://github.com/${{ github.repository }}/security)
        - [Issues é¡µé¢](https://github.com/${{ github.repository }}/issues)
        - [Pull Requests](https://github.com/${{ github.repository }}/pulls)
        - [Releases](https://github.com/${{ github.repository }}/releases)
        
        ---
        
        *æ­¤æ‘˜è¦ç”± GitHub Actions è‡ªåŠ¨ç”Ÿæˆ*
        EOF

    - name: Upload workflow status summary
      uses: actions/upload-artifact@v3
      with:
        name: workflow-status-summary
        path: workflow-status.md

  notification:
    runs-on: ubuntu-latest
    if: github.event.workflow_run.conclusion == 'failure'
    steps:
    - name: Workflow failure notification
      run: |
        echo "::warning::Workflow ${{ github.event.workflow_run.name }} failed"
        echo "Workflow: ${{ github.event.workflow_run.name }}"
        echo "Conclusion: ${{ github.event.workflow_run.conclusion }}"
        echo "URL: ${{ github.event.workflow_run.html_url }}"